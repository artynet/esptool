#!/usr/bin/make -f

# This file was automatically generated by stdeb 0.10.0 at
# Fri, 17 Jun 2022 11:01:59 +0000

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_clean:
	python3 setup.py clean -a
	find . -name \*.pyc -exec rm {} \;
	rm -f CONTRIBUTING.html
	rm -f esptool.1 espefuse.1 espsecure.1
	rm -rf .pybuild

override_dh_auto_build:
	python3 setup.py build --force
	markdown CONTRIBUTING.md > CONTRIBUTING.html
	help2man --no-info --section 1 --include=debian/see-also \
	  --source="Esptool.py $(VER)" \
	  -n "ESP8266 and ESP32 ROM Bootloader Utility" \
	  --version-string="$(VER)" \
	  ./esptool \
	  | sed -e "s,esptool.py,esptool," \
	  -e "s,Esptool.py,esptool.py," \
	  -e "s,esptool v[0-9]\+.*,," \
	  -e "s,\[.*\],," \
	  -e "s,sage: esptool,sage: esptool [OPTION] COMMAND," \
	  -e "s,positional arguments,command arguments," \
	  -e "s,\.\.\.,," \
	  -e "s,{load.*version},," \
	  -e "s/\\\fR {.*},/,/" \
	  > esptool.1
	help2man --no-info --section 1 --include=debian/see-also \
	  --source="Esptool.py $(VER)" \
	  -n "ESP32 Secure Boot & Flash Encryption tool" \
	  --version-string="$(VER)" \
	  ./espsecure \
	  | sed -e "s,espsecure.py,espsecure," \
	  -e "s,Esptool.py,esptool.py," \
	  -e "s,espsecure v[0-9]\+.*,," \
	  -e "s,\[.*\],," \
	  -e "s,sage: espsecure,sage: espsecure [OPTION] COMMAND," \
	  -e "s,positional arguments,command arguments," \
	  -e "s,\.\.\.,," \
	  -e "s,{digest.*data},," \
	  > espsecure.1
	help2man --no-info --section 1 --include=debian/see-also \
	  --source="Esptool.py $(VER)" \
	  -n "ESP32 efuse get/set tool" \
	  --version-string="$(VER)" \
	  ./espefuse \
	  | sed -e "s,espefuse.py,espefuse," \
	  -e "s,Esptool.py,esptool.py," \
	  -e "s,espefuse v[0-9]\+.*,," \
	  -e "s,\[.*\],," \
	  -e "s,sage: espefuse,sage: espefuse [OPTION] COMMAND," \
	  -e "s,positional arguments,command arguments," \
	  -e "s,\.\.\.,," \
	  -e "s,{dump.*_mac},," \
	  > espefuse.1

override_dh_auto_install:
	python3 setup.py install --force --root=debian/esptool --no-compile -O0 --install-layout=deb  

override_dh_python2:
	dh_python2 --no-guessing-versions

